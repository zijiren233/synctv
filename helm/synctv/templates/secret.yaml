{{- if not .Values.existingSecret -}}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "synctv.secretName" . }}
  labels:
    {{- include "synctv.labels" . | nindent 4 }}
type: Opaque
stringData:
  # Database URL (full connection string including credentials)
  SYNCTV_DATABASE_URL: {{ printf "postgresql://%s:%s@%s:%v/%s" .Values.secrets.database.username .Values.secrets.database.password .Values.config.database.host (int .Values.config.database.port) .Values.config.database.name | quote }}

  # Redis URL (full connection string including password)
  {{- if .Values.secrets.redis.password }}
  SYNCTV_REDIS_URL: {{ printf "redis://:%s@%s:%v" .Values.secrets.redis.password .Values.config.redis.host (int .Values.config.redis.port) | quote }}
  {{- else }}
  SYNCTV_REDIS_URL: {{ printf "redis://%s:%v" .Values.config.redis.host (int .Values.config.redis.port) | quote }}
  {{- end }}

  # JWT Secret
  SYNCTV_JWT_SECRET: {{ .Values.secrets.jwt.secret | quote }}

  # Cluster gRPC Auth Secret
  SYNCTV_SERVER_CLUSTER_SECRET: {{ .Values.secrets.cluster.grpcSecret | quote }}

  # Email SMTP Credentials
  {{- if .Values.config.email.smtpHost }}
  SYNCTV_EMAIL_SMTP_USERNAME: {{ .Values.secrets.email.username | quote }}
  SYNCTV_EMAIL_SMTP_PASSWORD: {{ .Values.secrets.email.password | quote }}
  {{- end }}

  # Credential Encryption Key (AES-256-GCM)
  {{- if .Values.secrets.credentialEncryptionKey }}
  SYNCTV_CREDENTIAL_ENCRYPTION_KEY: {{ .Values.secrets.credentialEncryptionKey | quote }}
  {{- end }}

  # OAuth2 Encryption Key (AES-256-GCM)
  {{- if .Values.secrets.oauth2EncryptionKey }}
  SYNCTV_OAUTH2_ENCRYPTION_KEY: {{ .Values.secrets.oauth2EncryptionKey | quote }}
  {{- end }}

  # Bootstrap root password
  {{- if .Values.secrets.bootstrap }}
  {{- if .Values.secrets.bootstrap.rootPassword }}
  SYNCTV_BOOTSTRAP_ROOT_PASSWORD: {{ .Values.secrets.bootstrap.rootPassword | quote }}
  {{- end }}
  {{- end }}
{{- end }}
